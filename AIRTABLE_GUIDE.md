# Airtable バックエンド運用ガイド

## 📋 概要

このダッシュボードは **Airtable** をバックエンドとして使用しています。Airtableはノーコードツールのため、ユーザーが直接カラム名やデータ構造を変更できる柔軟性がありますが、同時にアプリケーションの動作に影響を与える可能性があります。

このガイドでは、Airtable側で安全に変更できる項目と、変更を避けるべき項目を明確に示します。

## 🎯 対象者

- Airtableの管理者
- データ入力担当者
- システム管理者

## ✅ 安全に変更できる項目

### 1. データの追加・編集・削除
- **売上データの追加**: 新しい取引データの入力
- **既存データの編集**: 金額、日付、商品名などの修正
- **データの削除**: 不要なレコードの削除

### 2. カラムの追加
- **新しい分析用カラム**: アプリケーションで使用しない新しいカラムの追加
- **メモ・備考カラム**: 内部管理用のカラム

### 3. ビューの作成・編集
- **フィルタービューの作成**: 特定条件でのデータ表示
- **ソート順の変更**: データの並び順の調整
- **グループ化ビューの作成**: データのグループ化表示

### 4. フォームの設定
- **データ入力フォーム**: 新しいデータ入力用のフォーム作成
- **バリデーションルール**: データ入力時の検証ルール設定

## ⚠️ 変更を避けるべき項目

### 1. 必須カラム名の変更
以下のカラム名は**絶対に変更しないでください**：

#### 売上データテーブル (`tblthgeljeKsEteau`)
```
- id (自動生成)
- Name (商品名)
- ユーザーID (ユーザーID)
- 商品名 (商品名)
- カテゴリ (カテゴリ)
- 寄付金額 (売上金額 - 数値型)
- 注文日時 (取引日)
- 都道府県 (都道府県)
- 年代 (年代)
- 性別 (性別)
- 支払い方法 (支払い方法)
- ステータス (ステータス)
- プラットフォームカテゴリ (プラットフォーム - リンクフィールド)
```

#### プラットフォームテーブル (`tblRzKxxlatgPFJoE`)
```
- id (自動生成)
- Name (プラットフォーム名)
- 縦連結 (リンクフィールド)
```

### 2. データ型の変更
- **リンクフィールド**: `プラットフォームカテゴリ` は必ずリンクフィールドとして維持
- **数値フィールド**: `寄付金額` は必ず数値型として維持
- **日付フィールド**: `注文日時` は必ず日付型として維持

### 3. テーブル構造の変更
- **テーブル名**: 現在のテーブル名を変更しない
- **テーブルの削除**: 既存テーブルを削除しない
- **テーブルの複製**: 既存テーブルを複製して名前を変更する場合は、アプリケーション側の設定も更新が必要

## 🔧 変更が必要な場合の手順

### 1. カラム名を変更したい場合

**手順:**
1. 開発チームに事前に相談
2. アプリケーション側のコード修正が必要
3. テスト環境での動作確認
4. 本番環境への反映

**影響範囲:**
- `src/repositories/sales_data_repository.ts`
- `src/models/sales_data.ts`
- その他関連ファイル

### 2. 新しいカラムを追加したい場合

**推奨手順:**
1. カラム名は英語で統一（例: `newColumn`）
2. 適切なデータ型を選択
3. 必要に応じてバリデーション設定
4. アプリケーション側で使用する場合は開発チームに相談

### 3. プラットフォームを追加したい場合

**手順:**
1. プラットフォームテーブルに新しいレコードを追加
2. 売上データテーブルの `プラットフォームカテゴリ` フィールドで新しいプラットフォームを選択可能
3. アプリケーション側のマッピング設定を更新（必要に応じて）

## 📊 現在のデータ構造

### 現在のプラットフォーム設定
アプリケーションでは以下のプラットフォームIDと名前のマッピングが設定されています：

| プラットフォームID | プラットフォーム名 |
|------------------|------------------|
| rec5y6uYA61ufVnPY | ふるさとチョイス |
| recE2xXek8GyjVaQk | さとふる |
| recdIdd4rOYpkcaSB | 楽天ふるさと納税 |

**⚠️ 注意**: プラットフォームテーブルでレコードを削除する場合は、上記のIDが使用されていないことを確認してください。

### 売上データテーブル
| カラム名 | データ型 | 必須 | 説明 |
|---------|---------|------|------|
| id | 自動番号 | ✅ | レコードの一意識別子 |
| Name | 単一行テキスト | ✅ | 商品名 |
| ユーザーID | 単一行テキスト | ✅ | ユーザーID |
| 商品名 | 単一行テキスト | ✅ | 商品名 |
| カテゴリ | 単一行テキスト | ✅ | 商品カテゴリ |
| 寄付金額 | 数値 | ✅ | 売上金額 |
| 注文日時 | 日付 | ✅ | 取引日 |
| 都道府県 | 単一行テキスト | ✅ | 都道府県 |
| 年代 | 単一行テキスト | ✅ | 年代（20代、30代、40代、50代、60代、70代以上） |
| 性別 | 単一行テキスト | ✅ | 性別（男性、女性） |
| 支払い方法 | 単一行テキスト | ✅ | 支払い方法 |
| ステータス | 単一行テキスト | ✅ | 注文ステータス |
| プラットフォームカテゴリ | リンク | ✅ | プラットフォームへのリンク |

### プラットフォームテーブル
| カラム名 | データ型 | 必須 | 説明 |
|---------|---------|------|------|
| id | 自動番号 | ✅ | レコードの一意識別子 |
| Name | 単一行テキスト | ✅ | プラットフォーム名 |
| 縦連結 | リンク | ✅ | 売上データテーブルへのリンク |

## 🚨 トラブルシューティング

### よくある問題と解決方法

#### 1. ダッシュボードでデータが表示されない
**原因:** カラム名が変更された可能性
**解決方法:** 
- カラム名が正しいか確認
- 開発チームに連絡

#### 2. プラットフォームフィルターが動作しない
**原因:** プラットフォームテーブルのレコードが削除された可能性
**解決方法:**
- プラットフォームテーブルに必要なレコードが存在するか確認
- 売上データの `platformCategory` が正しくリンクされているか確認

#### 3. 日付フィルターが動作しない
**原因:** `注文日時` カラムのデータ型が変更された可能性
**解決方法:**
- `注文日時` カラムが日付型になっているか確認
- 日付データが正しい形式で入力されているか確認

## 📞 サポート

### 緊急時
- **データが表示されない**: 開発チームに即座に連絡
- **エラーが発生**: エラーメッセージをスクリーンショットで保存して連絡

### 通常の相談
- **新しいカラムの追加**: 事前に相談
- **データ構造の変更**: 開発チームと協議

### 連絡先
- **開発チーム**: [開発チームの連絡先]
- **システム管理者**: [管理者の連絡先]

## 📝 変更履歴

| 日付 | 変更内容 | 変更者 |
|------|---------|--------|
| 2024-08-07 | 初版作成 | 開発チーム |

---

**⚠️ 重要**: このガイドに記載されていない変更を行う場合は、必ず開発チームに事前相談してください。予期しない動作やデータ損失の原因となる可能性があります。 